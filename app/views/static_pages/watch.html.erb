 <div align="center" id="player"></div>

  <script>
    // 2. This code loads the IFrame Player API code asynchronously.
    var tag = document.createElement('script');

    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    // 3. This function creates an <iframe> (and YouTube player)
      //    after the API code downloads.
      var player;
      var feed_index = 1;
      var vid_id = "hORUSzOvUfM";

      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          height: '705',
          width: '940',
          videoId: '<%= current_user.feed[0].vid_id %>',
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }

      // 4. The API will call this function when the video player is ready.
      function onPlayerReady(event) {
        event.target.playVideo();
        getNewVideoId();
      }

      function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.ENDED ) {
          player.loadVideoById(vid_id);
          feed_index++; 
          getNewVideoId();
        };
      }

      function getNewVideoId() {
          $.ajax({
            type: 'GET',
            url: '/feed_item',
            data: { feed_item_id: feed_index },
            dataType: 'text',
            success: function(data){
              vid_id = data;
            }
          });
        }

    </script>

